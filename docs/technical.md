# Technical Overview

## Stack Summary
- **Framework:** Flutter 3 (Dart 3)
- **State management:** Riverpod (`flutter_riverpod`)
- **Navigation:** `go_router` with `StatefulShellRoute` for bottom navigation scaffolding
- **UI toolkit:** Material 3 components with custom widgets located in `lib/widgets`
- **Build tooling:** Standard Flutter CLI, `analysis_options.yaml` for lint rules

## Project Layout
```
lib/
  app.dart                  # Root MaterialApp + theme
  flavors.dart              # Environment-specific app titles/flavors
  router/                   # GoRouter configuration & refresh notifier
  features/
    home/                   # Home dashboard, feature models, list/detail views
    explore/                # Explore feed with hero banner & feature grid
    plan/                   # Timeline planning experience with mock data
    favorites/              # Saved plans (static content)
    profile/                # Profile placeholder
    location/               # Onboarding location selection + Riverpod providers
    onboading/              # Onboarding/change-location screen
  widgets/                  # Reusable UI components (banners, grids, profile sections, sheets)
```

## Core Concepts
### Navigation
- `lib/router/app_router.dart` defines the global `GoRouter`.
- Uses `StatefulShellRoute.indexedStack` to keep branch state in sync with the bottom navigation shell (`MainNavigationShell`).
- Each bottom nav branch (Home, Plan, Explore, Favorites, Profile) is isolated in its own `StatefulShellBranch`.
- Additional push navigation is done with the stock `Navigator` inside feature modules (e.g., Home feature list/detail flow).

### State Management
- Riverpod providers live under `lib/features/location/providers`.
- `LocationController` exposes async state for the user’s selected country/city, consumed across onboarding and the home greeting.
- Other modules currently rely on mock data, but the pattern is in place to introduce additional providers when real APIs are connected.

### Higher-Level Widgets
- `WelcomeBanner`, `CityContextGrid`, `CityDetailPage`, `FeatureCard`, `PlanHeroBanner`, `TripTimeline`, `PlanAheadSection`, `ProfileHeader`, and `ProfileSettingsCard` centralize styling and interaction patterns.
- Floating action buttons and bottom sheets (e.g., `QuickPlannerSheet`, profile edit/privacy/notification sheets) are kept separate for testability and reuse.

### Timeline Planning Flow
- `PlanPage` maintains a mutable list of `TimelineEntry` objects.
- Cards in the timeline respond to tap (preview modal) and long-press (edit modal) gestures via callbacks wired through `TripTimeline`.
- Editor sheet validates inputs, returning a new or updated entry back to the page state.

### Home Feature Lists
- `HomeFeature` / `FeatureListSection` / `FeatureListEntry` define structured mock content for each home tile.
- `FeatureListPage` renders grouped lists with section headers and uses `FeatureDetailPage` for deeper content preview.
- Replace these mock model instances with data from APIs or CMS as the product matures.

### Profile & Auth Flow
- Lightweight auth state lives in `lib/features/auth/providers/auth_provider.dart`; the profile page watches this provider to toggle guest vs. signed-in experiences.
- Profile UI is composed from reusable widgets (`ProfileHeader`, `GuestAuthActions`, `PreferencesSection`, `ProfileSettingsCard`) so other features can reuse the same sections if needed.
- Guest users see sign-in/create-account CTAs and limited settings, while signed-in users can edit profile details, preferences, privacy, and notification options.

## Environment & Tooling
- **Run the app:** `flutter run`
- **Static analysis:** `flutter analyze`
- **Widget/unit tests:** `flutter test`
- To add dependencies, use `flutter pub add <package>` and commit updated `pubspec.yaml` + `pubspec.lock`.
- iOS/Android platform folders are generated by Flutter and follow the standard structure; no native changes required yet.

## Extending the Codebase
1. **Create a new feature:** add a directory under `lib/features/<feature_name>` and expose UI through a page widget.
2. **Register navigation:** append a `StatefulShellBranch` (if it belongs in bottom navigation) or a child `GoRoute` within the relevant branch.
3. **Share styling:** place reusable components in `lib/widgets`.
4. **Stateful data:** add Riverpod providers inside the feature or a shared providers folder; keep logic out of widgets.
5. **Testing:** write widget or unit tests under `test/` mirroring the directory structure of the production code.

## Quality Gates
- Lints defined in `analysis_options.yaml` enforce best practices; ensure CI or pre-commit hooks run `flutter analyze`.
- Favor small, focused widgets and prefer `const` constructors where possible for performance.
- When introducing network layers, add abstraction (repositories/services) to keep presentation widgets agnostic of API details.

## Future Enhancements (Suggested)
- Replace mock data with real content sources (GraphQL/REST).
- Persist user actions (selected preferences, timeline items) using local storage or a backend service.
- Introduce analytics hooks for activation/retention metrics outlined in the README.
- Add golden tests for shared widgets and integration tests for critical flows (onboarding → planning).
